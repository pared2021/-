# 硬编码导入修复计划

## 背景
文件名：hardcoded_import_fix_plan_20250721.md
创建于：2025-07-21
创建者：Claude Assistant
主分支：main
任务分支：task/hardcoded_import_fix_20250721

## 任务描述
修复项目中256个硬编码导入问题，将`from src.`绝对导入转换为相对导入，提高代码的可移植性和模块化程度。

## 项目概览
游戏自动化工具项目，采用Clean Architecture架构，包含多个模块：
- 核心业务逻辑（core/）
- 应用服务层（application/）
- 基础设施层（infrastructure/）
- 表示层（presentation/）
- GUI界面（gui/）
- 游戏适配器（games/）
- 通用工具（common/）

## 分析

### 硬编码导入问题分布
1. **主要问题文件**：
   - `src/main.py` - 15个导入
   - `src/gui/main_window.py` - 50+个导入
   - `src/application/containers/main_container.py` - 11个导入
   - `src/common/containers.py` - 8个导入
   - 各游戏适配器文件 - 每个3-4个导入

2. **导入模式分析**：
   - `from src.common.` - 通用模块导入
   - `from src.core.` - 核心模块导入
   - `from src.services.` - 服务层导入
   - `from src.application.` - 应用层导入
   - `from src.infrastructure.` - 基础设施层导入

3. **影响范围**：
   - 跨模块依赖关系复杂
   - 测试文件也包含硬编码导入
   - 根目录main.py作为入口点的特殊处理

## 提议的解决方案

### 方案1：渐进式修复（推荐）
**优势**：
- 风险可控，可以逐步验证
- 便于回滚和调试
- 可以优先处理关键模块

**实施步骤**：
1. 修复叶子节点模块（依赖最少的模块）
2. 逐步向上修复依赖链
3. 最后处理入口文件和主要集成点

### 方案2：按模块分组修复
**优势**：
- 保持模块内部一致性
- 便于测试单个模块
- 符合架构分层原则

**实施顺序**：
1. common/ - 通用工具模块
2. core/ - 核心业务逻辑
3. infrastructure/ - 基础设施层
4. application/ - 应用服务层
5. services/ - 服务层
6. games/ - 游戏适配器
7. gui/ - 用户界面
8. 入口文件和测试文件

### 方案3：自动化工具修复
**优势**：
- 快速批量处理
- 减少人工错误
- 一致性好

**风险**：
- 可能产生错误的相对路径
- 需要大量测试验证
- 复杂依赖关系处理困难

## 当前执行步骤："1. 创建修复计划"

## 推荐实施策略

### 阶段1：准备工作
1. 创建功能分支
2. 备份当前代码
3. 建立测试基准
4. 分析依赖关系图

### 阶段2：核心模块修复（优先级：高）
**目标文件**：
- `src/common/` 目录下的所有文件
- `src/core/` 目录下的基础文件
- `src/services/config.py`
- `src/services/logger.py`
- `src/services/error_handler.py`

### 阶段3：服务层修复（优先级：中）
**目标文件**：
- `src/services/` 目录下的其他文件
- `src/infrastructure/` 目录下的文件

### 阶段4：应用层修复（优先级：中）
**目标文件**：
- `src/application/` 目录下的文件
- `src/core/use_cases/` 目录下的文件

### 阶段5：界面和适配器修复（优先级：低）
**目标文件**：
- `src/gui/` 目录下的文件
- `src/games/` 目录下的文件
- `src/presentation/` 目录下的文件

### 阶段6：入口文件和测试修复（优先级：低）
**目标文件**：
- `src/main.py`
- 根目录 `main.py`
- 测试文件

## 相对导入转换规则

### 基本规则
1. **同级目录**：`from .module import Class`
2. **父级目录**：`from ..parent_module import Class`
3. **子级目录**：`from .subdir.module import Class`
4. **跨层级**：根据相对路径计算`..`的数量

### 特殊处理
1. **入口文件**：保持绝对导入或使用sys.path处理
2. **测试文件**：可能需要特殊的路径处理
3. **配置文件**：确保配置路径的正确性

## 验证策略

### 自动化测试
1. 运行现有单元测试
2. 执行集成测试
3. 检查导入语法正确性

### 手动验证
1. 启动GUI应用
2. 测试CLI功能
3. 验证各游戏适配器
4. 检查配置系统

## 风险评估

### 高风险区域
1. **循环依赖**：可能在修复过程中暴露
2. **动态导入**：运行时导入可能失败
3. **路径计算错误**：相对路径计算错误

### 缓解措施
1. 分阶段实施，每阶段后进行测试
2. 保持详细的修改记录
3. 准备快速回滚方案
4. 使用自动化工具验证导入正确性

## 任务进度
[待更新]

## 最终审查
[待完成]