# ğŸ—ï¸ æ¶æ„è®¾è®¡æ–‡æ¡£

## ğŸ“– æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†æ¸¸æˆè‡ªåŠ¨åŒ–å·¥å…·çš„æ¶æ„è®¾è®¡ï¼Œè§£é‡Šäº†ä»ä¼ ç»ŸMVVMæ¶æ„åˆ°ç°ä»£åŒ–å››å±‚åˆ†å±‚æ¶æ„çš„æ¼”è¿›è¿‡ç¨‹ï¼Œä»¥åŠæ–°æ¶æ„çš„è®¾è®¡ç†å¿µã€å®ç°ç»†èŠ‚å’Œä½¿ç”¨æŒ‡å¯¼ã€‚

## ğŸ¯ è®¾è®¡ç†å¿µå’ŒåŸåˆ™

### æ ¸å¿ƒç†å¿µ

**åˆ†ç¦»å…³æ³¨ç‚¹ (Separation of Concerns)**
> æ¯ä¸ªå±‚æ¬¡åªè´Ÿè´£ç‰¹å®šçš„èŒè´£ï¼Œé¿å…åŠŸèƒ½æ··æ‚

**å•å‘ä¾èµ– (Unidirectional Dependencies)**
> å»ºç«‹æ¸…æ™°çš„ä¾èµ–æ–¹å‘ï¼Œé¿å…å¾ªç¯ä¾èµ–

**é«˜å†…èšä½è€¦åˆ (High Cohesion, Low Coupling)**
> å±‚å†…åŠŸèƒ½é«˜åº¦ç›¸å…³ï¼Œå±‚é—´ä¾èµ–æœ€å°åŒ–

**å¼€æ”¾å°é—­åŸåˆ™ (Open-Closed Principle)**
> å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­

### è®¾è®¡åŸåˆ™

1. **èŒè´£å•ä¸€åŸåˆ™**: æ¯ä¸ªç»„ä»¶åªæœ‰ä¸€ä¸ªå˜åŒ–çš„ç†ç”±
2. **ä¾èµ–å€’ç½®åŸåˆ™**: é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œéƒ½ä¾èµ–æŠ½è±¡
3. **æ¥å£éš”ç¦»åŸåˆ™**: ä¸ä¾èµ–ä¸éœ€è¦çš„æ¥å£
4. **æœ€å°çŸ¥è¯†åŸåˆ™**: ç»„ä»¶åªä¸ç›´æ¥åˆä½œçš„ç»„ä»¶äº¤äº’

## ğŸ—ï¸ åˆ†å±‚æ¶æ„è¯¦è§£

### æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                UI å±‚                    â”‚  ğŸ–¥ï¸ ç”¨æˆ·ç•Œé¢å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚    å±•ç¤ºé€»è¾‘ â”‚ ç”¨æˆ·äº¤äº’ â”‚ è§†å›¾ç®¡ç†   â”‚â”‚  
â”‚  â”‚  ç•Œé¢ç»„ä»¶ â”‚ äº‹ä»¶å¤„ç† â”‚ æ•°æ®ç»‘å®š   â”‚â”‚  
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ è°ƒç”¨ä¸šåŠ¡æ¥å£
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Core å±‚                   â”‚  ğŸ¯ æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  æ¸¸æˆåˆ†æ â”‚ å†³ç­–å¼•æ“ â”‚ ä»»åŠ¡ç¼–æ’   â”‚â”‚  
â”‚  â”‚  çŠ¶æ€ç®¡ç† â”‚ ä¸šåŠ¡è§„åˆ™ â”‚ æ•°æ®æ¨¡å‹   â”‚â”‚  
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ä½¿ç”¨æŠ€æœ¯æœåŠ¡
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Services å±‚                 â”‚  ğŸ”§ åŸºç¡€æœåŠ¡å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  é…ç½®ç®¡ç† â”‚ æ—¥å¿—æœåŠ¡ â”‚ çª—å£ç®¡ç†   â”‚â”‚  
â”‚  â”‚  å›¾åƒå¤„ç† â”‚ è¾“å…¥æ¨¡æ‹Ÿ â”‚ èµ„æºç®¡ç†   â”‚â”‚  
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ ä¾èµ–åŸºç¡€è®¾æ–½
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             Common å±‚                   â”‚  ğŸ”— é€šç”¨åŸºç¡€è®¾æ–½å±‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  ä¾èµ–æ³¨å…¥ â”‚ å¼‚å¸¸å¤„ç† â”‚ é”™è¯¯æ¢å¤   â”‚â”‚  
â”‚  â”‚  ç³»ç»Ÿåˆå§‹åŒ–â”‚ ç›‘æ§å·¥å…· â”‚ é€šç”¨å·¥å…·   â”‚â”‚  
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–å…³ç³»å›¾

```mermaid
graph TB
    UI[UI å±‚] --> Core[Core å±‚]
    Core --> Services[Services å±‚]
    Services --> Common[Common å±‚]
    
    UI -.-> Utils[Utils å·¥å…·]
    Core -.-> Utils
    
    subgraph "UI å±‚ç»„ä»¶"
        Windows[windows/]
        Widgets[widgets/]
        Panels[panels/]
        ViewModels[viewmodels/]
    end
    
    subgraph "Core å±‚ç»„ä»¶"
        Analyzers[analyzers/]
        Engines[engines/]
        Executors[executors/]
        Models[models/]
    end
    
    subgraph "Services å±‚ç»„ä»¶"
        Config[config]
        Logger[logger]
        WindowMgr[window_manager]
        ImageProc[image_processor]
    end
    
    subgraph "Common å±‚ç»„ä»¶"
        Container[dependency injection]
        Recovery[error recovery]
        Exceptions[exception hierarchy]
        Monitor[system monitor]
    end
```

## ğŸ“‹ èŒè´£åˆ†é…è¯´æ˜

### UI å±‚ (User Interface Layer)

**èŒè´£**: ç”¨æˆ·äº¤äº’ç•Œé¢å’Œå±•ç¤ºé€»è¾‘

**åŒ…å«ç»„ä»¶**:
```
src/ui/
â”œâ”€â”€ windows/         # ä¸»çª—å£å’Œå¯¹è¯æ¡†
â”œâ”€â”€ widgets/         # å¯å¤ç”¨çš„UIæ§ä»¶
â”œâ”€â”€ panels/          # åŠŸèƒ½é¢æ¿ç»„ä»¶
â”œâ”€â”€ components/      # é€šç”¨UIç»„ä»¶
â”œâ”€â”€ managers/        # UIçŠ¶æ€ç®¡ç†å™¨
â”œâ”€â”€ viewmodels/      # è§†å›¾æ¨¡å‹ï¼ˆMVVMæ¨¡å¼ï¼‰
â”œâ”€â”€ styles/          # ç•Œé¢æ ·å¼å’Œä¸»é¢˜
â””â”€â”€ editors/         # é…ç½®å’Œä»£ç ç¼–è¾‘å™¨
```

**æ ¸å¿ƒèŒè´£**:
- âœ… ç”¨æˆ·ç•Œé¢å±•ç¤ºå’Œå¸ƒå±€
- âœ… ç”¨æˆ·è¾“å…¥äº‹ä»¶å¤„ç†
- âœ… æ•°æ®ç»‘å®šå’Œè§†å›¾æ›´æ–°
- âœ… ç•Œé¢çŠ¶æ€ç®¡ç†
- âœ… ç”¨æˆ·äº¤äº’ä½“éªŒä¼˜åŒ–

**ä¸è´Ÿè´£**:
- âŒ ä¸šåŠ¡é€»è¾‘å¤„ç†
- âŒ æ•°æ®æŒä¹…åŒ–
- âŒ æ¸¸æˆåˆ†æç®—æ³•
- âŒ ç³»ç»Ÿçº§æ“ä½œ

### Core å±‚ (Business Logic Layer)

**èŒè´£**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘å’Œé¢†åŸŸæ¨¡å‹

**åŒ…å«ç»„ä»¶**:
```
src/core/
â”œâ”€â”€ unified_game_analyzer.py  # ç»Ÿä¸€æ¸¸æˆåˆ†æå™¨
â”œâ”€â”€ task_system.py           # ä»»åŠ¡ç¼–æ’ç³»ç»Ÿ
â”œâ”€â”€ state_machine.py         # çŠ¶æ€æœºç®¡ç†
â”œâ”€â”€ game_adapter.py          # æ¸¸æˆé€‚é…å™¨
â”œâ”€â”€ analyzers/              # åˆ†æå™¨ç»„ä»¶
â”‚   â”œâ”€â”€ image_recognition.py    # å›¾åƒè¯†åˆ«åˆ†æ
â”‚   â””â”€â”€ pattern_matcher.py      # æ¨¡å¼åŒ¹é…åˆ†æ
â”œâ”€â”€ engines/               # å†³ç­–å¼•æ“
â”‚   â”œâ”€â”€ decision_engine.py      # å†³ç­–å¼•æ“
â”‚   â””â”€â”€ dqn_agent.py           # DQNå¼ºåŒ–å­¦ä¹ ä»£ç†
â”œâ”€â”€ executors/             # æ‰§è¡Œå™¨ç»„ä»¶
â”‚   â”œâ”€â”€ action_executor.py      # åŠ¨ä½œæ‰§è¡Œå™¨
â”‚   â””â”€â”€ input_controller.py     # è¾“å…¥æ§åˆ¶å™¨
â”œâ”€â”€ collectors/            # æ•°æ®æ”¶é›†å™¨
â”‚   â””â”€â”€ screen_collector.py     # å±å¹•æ•°æ®æ”¶é›†
â”œâ”€â”€ models/               # ä¸šåŠ¡æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ game_state.py          # æ¸¸æˆçŠ¶æ€æ¨¡å‹
â”‚   â””â”€â”€ state_history_model.py  # çŠ¶æ€å†å²æ¨¡å‹
â””â”€â”€ automation/           # è‡ªåŠ¨åŒ–é€»è¾‘
    â””â”€â”€ auto_operator.py        # è‡ªåŠ¨åŒ–æ“ä½œå™¨
```

**æ ¸å¿ƒèŒè´£**:
- âœ… æ¸¸æˆçŠ¶æ€åˆ†æå’Œè¯†åˆ«
- âœ… å†³ç­–é€»è¾‘å’Œç­–ç•¥åˆ¶å®š
- âœ… ä»»åŠ¡ç¼–æ’å’Œæµç¨‹æ§åˆ¶
- âœ… ä¸šåŠ¡è§„åˆ™å’Œçº¦æŸç®¡ç†
- âœ… é¢†åŸŸæ¨¡å‹å’Œæ•°æ®ç»“æ„

**ä¸è´Ÿè´£**:
- âŒ ç”¨æˆ·ç•Œé¢å±•ç¤º
- âŒ åº•å±‚æŠ€æœ¯æœåŠ¡
- âŒ ç³»ç»Ÿçº§é…ç½®ç®¡ç†
- âŒ åŸºç¡€è®¾æ–½åŠŸèƒ½

### Services å±‚ (Technical Services Layer)

**èŒè´£**: æŠ€æœ¯æœåŠ¡å’ŒåŸºç¡€åŠŸèƒ½

**åŒ…å«ç»„ä»¶**:
```
src/services/
â”œâ”€â”€ config.py              # é…ç½®ç®¡ç†æœåŠ¡
â”œâ”€â”€ logger.py              # æ—¥å¿—è®°å½•æœåŠ¡
â”œâ”€â”€ window_manager.py      # çª—å£ç®¡ç†æœåŠ¡
â”œâ”€â”€ image_processor.py     # å›¾åƒå¤„ç†æœåŠ¡
â”œâ”€â”€ action_simulator.py    # åŠ¨ä½œæ¨¡æ‹ŸæœåŠ¡
â”œâ”€â”€ template_collector.py  # æ¨¡æ¿æ”¶é›†æœåŠ¡
â”œâ”€â”€ capture_engines.py     # å¤šå¼•æ“æ•è·ç³»ç»Ÿ
â”œâ”€â”€ resource_manager.py    # èµ„æºç®¡ç†æœåŠ¡
â”œâ”€â”€ exceptions.py          # æœåŠ¡ä¸“ç”¨å¼‚å¸¸
â””â”€â”€ game_analyzer.py       # æ¸¸æˆåˆ†æé€‚é…å™¨
```

**æ ¸å¿ƒèŒè´£**:
- âœ… é…ç½®æ•°æ®ç®¡ç†å’Œè®¿é—®
- âœ… æ—¥å¿—è®°å½•å’Œè°ƒè¯•æ”¯æŒ
- âœ… çª—å£æ•è·å’Œæ“ä½œ
- âœ… å›¾åƒå¤„ç†å’Œåˆ†æåŸºç¡€
- âœ… è¾“å…¥æ¨¡æ‹Ÿå’Œç¡¬ä»¶äº¤äº’
- âœ… å¤–éƒ¨èµ„æºç®¡ç†

**ä¸è´Ÿè´£**:
- âŒ ä¸šåŠ¡å†³ç­–é€»è¾‘
- âŒ ç”¨æˆ·ç•Œé¢ç»„ä»¶
- âŒ ç³»ç»Ÿåˆå§‹åŒ–æµç¨‹
- âŒ ä¾èµ–æ³¨å…¥ç®¡ç†

### Common å±‚ (Infrastructure Layer)

**èŒè´£**: é€šç”¨åŸºç¡€è®¾æ–½å’Œè·¨å±‚æ¬¡æ”¯æŒ

**åŒ…å«ç»„ä»¶**:
```
src/common/
â”œâ”€â”€ containers.py          # ä¾èµ–æ³¨å…¥å®¹å™¨
â”œâ”€â”€ recovery.py            # é”™è¯¯æ¢å¤æœºåˆ¶
â”œâ”€â”€ system_initializer.py  # ç³»ç»Ÿåˆå§‹åŒ–å™¨
â”œâ”€â”€ exceptions.py          # é€šç”¨å¼‚å¸¸åŸºç±»
â”œâ”€â”€ error_handler.py       # é”™è¯¯å¤„ç†å™¨
â”œâ”€â”€ monitor.py             # ç³»ç»Ÿç›‘æ§å·¥å…·
â”œâ”€â”€ app_utils.py           # åº”ç”¨çº§å·¥å…·å‡½æ•°
â””â”€â”€ system_cleanup.py      # ç³»ç»Ÿæ¸…ç†å·¥å…·
```

**æ ¸å¿ƒèŒè´£**:
- âœ… ä¾èµ–æ³¨å…¥å’Œå¯¹è±¡ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æ¢å¤
- âœ… ç³»ç»Ÿåˆå§‹åŒ–å’Œé…ç½®
- âœ… è·¨å±‚æ¬¡çš„é€šç”¨å·¥å…·
- âœ… åº”ç”¨çº§ç›‘æ§å’Œè¯Šæ–­

**ä¸è´Ÿè´£**:
- âŒ å…·ä½“ä¸šåŠ¡é€»è¾‘
- âŒ ç”¨æˆ·ç•Œé¢åŠŸèƒ½
- âŒ æŠ€æœ¯æœåŠ¡å®ç°
- âŒ é¢†åŸŸç›¸å…³æ¦‚å¿µ

## ğŸ”„ æ•°æ®æµå’Œæ§åˆ¶æµ

### å…¸å‹äº¤äº’æµç¨‹

```mermaid
sequenceDiagram
    participant UI as UI å±‚
    participant Core as Core å±‚
    participant Services as Services å±‚
    participant Common as Common å±‚
    
    UI->>Core: ç”¨æˆ·æ“ä½œè¯·æ±‚
    Core->>Services: è¯·æ±‚æŠ€æœ¯æœåŠ¡
    Services->>Common: ä½¿ç”¨åŸºç¡€è®¾æ–½
    Common-->>Services: æä¾›æ”¯æŒåŠŸèƒ½
    Services-->>Core: è¿”å›æœåŠ¡ç»“æœ
    Core->>Core: æ‰§è¡Œä¸šåŠ¡é€»è¾‘
    Core-->>UI: è¿”å›å¤„ç†ç»“æœ
    UI->>UI: æ›´æ–°ç•Œé¢æ˜¾ç¤º
```

### é”™è¯¯å¤„ç†æµç¨‹

```mermaid
graph TD
    A[å¼‚å¸¸å‘ç”Ÿ] --> B{å¼‚å¸¸ç±»å‹}
    B -->|UIå¼‚å¸¸| C[UIå±‚å¤„ç†]
    B -->|ä¸šåŠ¡å¼‚å¸¸| D[Coreå±‚å¤„ç†]
    B -->|æœåŠ¡å¼‚å¸¸| E[Serviceså±‚å¤„ç†]
    B -->|ç³»ç»Ÿå¼‚å¸¸| F[Commonå±‚å¤„ç†]
    
    C --> G[æ¢å¤ç®¡ç†å™¨]
    D --> G
    E --> G
    F --> G
    
    G --> H{èƒ½å¦è‡ªåŠ¨æ¢å¤}
    H -->|æ˜¯| I[æ‰§è¡Œæ¢å¤ç­–ç•¥]
    H -->|å¦| J[è®°å½•é”™è¯¯æ—¥å¿—]
    
    I --> K[æ¢å¤æˆåŠŸ]
    J --> L[ç”¨æˆ·å¤„ç†]
```

## ğŸ”Œ æ‰©å±•ç‚¹å’Œæ’ä»¶æœºåˆ¶

### ä¾èµ–æ³¨å…¥æ‰©å±•

```python
# æ³¨å†Œæ–°æœåŠ¡
from src.common.containers import DIContainer

container = DIContainer()

# æ³¨å†Œæ–°çš„åˆ†æå™¨
container.register('CustomAnalyzer', CustomAnalyzer, singleton=True)

# æ³¨å†ŒæœåŠ¡å·¥å‚
container.register_factory('DynamicService', create_dynamic_service)

# è·å–æœåŠ¡å®ä¾‹
analyzer = container.get('CustomAnalyzer')
```

### æ¸¸æˆåˆ†æå™¨æ‰©å±•

```python
# æ‰©å±•ç»Ÿä¸€æ¸¸æˆåˆ†æå™¨
from src.core.unified_game_analyzer import UnifiedGameAnalyzer

class CustomGameAnalyzer(UnifiedGameAnalyzer):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)
        self.custom_detectors = []
    
    def add_custom_detector(self, detector):
        """æ·»åŠ è‡ªå®šä¹‰æ£€æµ‹å™¨"""
        self.custom_detectors.append(detector)
    
    def analyze_frame(self, frame):
        """æ‰©å±•åˆ†æé€»è¾‘"""
        # è°ƒç”¨åŸºç¡€åˆ†æ
        result = super().analyze_frame(frame)
        
        # æ·»åŠ è‡ªå®šä¹‰æ£€æµ‹
        for detector in self.custom_detectors:
            custom_result = detector.detect(frame)
            result.update(custom_result)
        
        return result
```

### UIç»„ä»¶æ‰©å±•

```python
# æ‰©å±•UIç»„ä»¶
from src.ui.widgets.base_widget import BaseWidget

class CustomWidget(BaseWidget):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setup_ui()
    
    def setup_ui(self):
        """è®¾ç½®è‡ªå®šä¹‰UI"""
        # è‡ªå®šä¹‰ç•Œé¢é€»è¾‘
        pass
    
    def on_data_changed(self, data):
        """å¤„ç†æ•°æ®å˜åŒ–"""
        # è‡ªå®šä¹‰æ•°æ®å¤„ç†
        pass
```

### æœåŠ¡æ‰©å±•

```python
# æ‰©å±•æœåŠ¡å±‚
from src.services.base_service import BaseService

class CustomService(BaseService):
    def __init__(self, config, logger):
        super().__init__(config, logger)
        self.initialize()
    
    def initialize(self):
        """åˆå§‹åŒ–è‡ªå®šä¹‰æœåŠ¡"""
        pass
    
    def process_request(self, request):
        """å¤„ç†è‡ªå®šä¹‰è¯·æ±‚"""
        return self.custom_logic(request)
```

## ğŸš€ æ€§èƒ½è€ƒè™‘

### æ¶æ„æ€§èƒ½ä¼˜åŒ–

1. **åˆ†å±‚ç¼“å­˜ç­–ç•¥**:
   ```python
   # UIå±‚ç¼“å­˜
   - ç•Œé¢çŠ¶æ€ç¼“å­˜
   - æ¸²æŸ“ç»“æœç¼“å­˜
   
   # Coreå±‚ç¼“å­˜
   - åˆ†æç»“æœç¼“å­˜
   - å†³ç­–ç»“æœç¼“å­˜
   
   # Serviceså±‚ç¼“å­˜
   - é…ç½®æ•°æ®ç¼“å­˜
   - å›¾åƒå¤„ç†ç»“æœç¼“å­˜
   ```

2. **å¼‚æ­¥å¤„ç†æœºåˆ¶**:
   ```python
   # é•¿æ—¶é—´æ“ä½œå¼‚æ­¥åŒ–
   from asyncio import run, gather
   
   async def analyze_frame_async(frame):
       tasks = [
           analyzer.detect_objects(frame),
           analyzer.recognize_text(frame),
           analyzer.analyze_state(frame)
       ]
       results = await gather(*tasks)
       return combine_results(results)
   ```

3. **èµ„æºæ± åŒ–ç®¡ç†**:
   ```python
   # å¯¹è±¡æ± ç®¡ç†
   class AnalyzerPool:
       def __init__(self, size=10):
           self.pool = Queue(maxsize=size)
           for _ in range(size):
               self.pool.put(create_analyzer())
       
       def get_analyzer(self):
           return self.pool.get()
       
       def return_analyzer(self, analyzer):
           analyzer.reset()
           self.pool.put(analyzer)
   ```

### å†…å­˜ç®¡ç†ä¼˜åŒ–

1. **æ™ºèƒ½åƒåœ¾å›æ”¶**:
   ```python
   # å®šæœŸæ¸…ç†ä¸å¿…è¦çš„å¯¹è±¡
   import gc
   
   class MemoryManager:
       def periodic_cleanup(self):
           # æ¸…ç†è¿‡æœŸç¼“å­˜
           self.clear_expired_cache()
           # å¼ºåˆ¶åƒåœ¾å›æ”¶
           gc.collect()
   ```

2. **å¤§å¯¹è±¡æµå¼å¤„ç†**:
   ```python
   # æµå¼å¤„ç†å¤§å›¾åƒ
   def process_large_image_stream(image_path):
       with open(image_path, 'rb') as f:
           chunk_size = 1024 * 1024  # 1MB chunks
           while chunk := f.read(chunk_size):
               yield process_chunk(chunk)
   ```

## ğŸ“ˆ æ¼”è¿›å†å²

### ç¬¬ä¸€é˜¶æ®µï¼šç›®å½•ç»“æ„é‡æ„ (83.3%é€šè¿‡ç‡)

**é—®é¢˜**:
- 20+ä¸ªåˆ†æ•£ç›®å½•
- åŠŸèƒ½åˆ†æ•£ï¼Œéš¾ä»¥å®šä½
- é‡å¤å®ç°å’Œæ··ä¹±ä¾èµ–

**è§£å†³æ–¹æ¡ˆ**:
- ç®€åŒ–ä¸º10ä¸ªä¸»ç›®å½•
- æŒ‰åŠŸèƒ½èŒè´£é‡æ–°ç»„ç»‡
- ç»Ÿä¸€å¯¼å…¥è·¯å¾„

**æˆæœ**:
- ç›®å½•æ•°é‡å‡å°‘50%+
- åŠŸèƒ½å®šä½æ•ˆç‡æå‡
- ä»£ç ç»“æ„æ¸…æ™°åŒ–

### ç¬¬äºŒé˜¶æ®µï¼šæœåŠ¡èŒè´£é‡å®šä¹‰ (80.0%é€šè¿‡ç‡)

**é—®é¢˜**:
- Core/ServicesèŒè´£æ··ä¹±
- å¤šä¸ªé‡å¤å®ç°
- å¾ªç¯ä¾èµ–é£é™©

**è§£å†³æ–¹æ¡ˆ**:
- æ˜ç¡®å››å±‚æ¶æ„èŒè´£
- æ¶ˆé™¤é‡å¤å®ç°
- å»ºç«‹å•å‘ä¾èµ–æµ

**æˆæœ**:
- 100%å±‚æ¬¡èŒè´£çº¯åº¦
- 80%+é‡å¤ä»£ç æ¶ˆé™¤
- æ¸…æ™°çš„ä¾èµ–å…³ç³»

### ç¬¬ä¸‰é˜¶æ®µï¼šæ–‡æ¡£ç³»ç»Ÿå®Œå–„ (è¿›è¡Œä¸­)

**ç›®æ ‡**:
- å®Œæ•´çš„æ–‡æ¡£ä½“ç³»
- æ¸…æ™°çš„æ¶æ„è¯´æ˜
- å®ç”¨çš„å¼€å‘æŒ‡å¯¼

**è®¡åˆ’å†…å®¹**:
- æ›´æ–°READMEåæ˜ æ–°æ¶æ„
- åˆ›å»ºè¯¦ç»†æ¶æ„æ–‡æ¡£
- ç¼–å†™å¼€å‘è€…æŒ‡å—
- ç”ŸæˆAPIæ–‡æ¡£

## ğŸ”§ æœ€ä½³å®è·µ

### å¼€å‘æœ€ä½³å®è·µ

1. **éµå¾ªåˆ†å±‚åŸåˆ™**:
   ```python
   # âœ… æ­£ç¡®çš„è°ƒç”¨æ–¹å‘
   UI â†’ Core â†’ Services â†’ Common
   
   # âŒ é”™è¯¯çš„åå‘è°ƒç”¨
   Common â†’ Services  # è¿ååˆ†å±‚åŸåˆ™
   Services â†’ Core    # è¿ååˆ†å±‚åŸåˆ™
   ```

2. **ä½¿ç”¨ä¾èµ–æ³¨å…¥**:
   ```python
   # âœ… é€šè¿‡ä¾èµ–æ³¨å…¥è·å–æœåŠ¡
   def __init__(self, service_container):
       self.logger = service_container.get('Logger')
       self.config = service_container.get('Config')
   
   # âŒ ç›´æ¥åˆ›å»ºä¾èµ–å¯¹è±¡
   def __init__(self):
       self.logger = Logger()  # è¿åä¾èµ–æ³¨å…¥åŸåˆ™
   ```

3. **å¤„ç†å¼‚å¸¸çš„æ­£ç¡®æ–¹å¼**:
   ```python
   # âœ… ä½¿ç”¨åˆ†å±‚å¼‚å¸¸å¤„ç†
   from src.services.exceptions import ServiceException
   from src.common.recovery import RecoveryManager
   
   try:
       risky_operation()
   except ServiceException as e:
       recovery_manager.handle_error(e)
   
   # âŒ æ•è·é€šç”¨å¼‚å¸¸
   try:
       risky_operation()
   except Exception:
       pass  # ä¸¢å¤±é”™è¯¯ä¿¡æ¯
   ```

### æ‰©å±•æœ€ä½³å®è·µ

1. **æ·»åŠ æ–°åŠŸèƒ½æ—¶**:
   - é¦–å…ˆç¡®å®šåŠŸèƒ½å±äºå“ªä¸ªå±‚æ¬¡
   - éµå¾ªè¯¥å±‚æ¬¡çš„èŒè´£è¾¹ç•Œ
   - ä½¿ç”¨ä¾èµ–æ³¨å…¥ç®¡ç†ä¾èµ–
   - ç¼–å†™ç›¸åº”çš„æµ‹è¯•ç”¨ä¾‹

2. **ä¿®æ”¹ç°æœ‰åŠŸèƒ½æ—¶**:
   - ç†è§£å½“å‰çš„æ¶æ„è®¾è®¡
   - æœ€å°åŒ–è·¨å±‚æ¬¡çš„å½±å“
   - ä¿æŒæ¥å£çš„å‘åå…¼å®¹æ€§
   - æ›´æ–°ç›¸å…³æ–‡æ¡£

3. **æ€§èƒ½ä¼˜åŒ–æ—¶**:
   - é¦–å…ˆç¡®å®šæ€§èƒ½ç“¶é¢ˆæ‰€åœ¨å±‚æ¬¡
   - åœ¨å¯¹åº”å±‚æ¬¡å†…è¿›è¡Œä¼˜åŒ–
   - é¿å…ç ´åæ¶æ„è¾¹ç•Œ
   - ç›‘æ§ä¼˜åŒ–æ•ˆæœ

## ğŸ” æ¶æ„éªŒè¯

### é™æ€åˆ†æå·¥å…·

```bash
# ä¾èµ–å…³ç³»åˆ†æ
python -m pydeps src --show-deps

# ä»£ç è´¨é‡æ£€æŸ¥
python -m pylint src

# ç±»å‹æ£€æŸ¥
python -m mypy src
```

### æ¶æ„æµ‹è¯•

```python
# æ¶æ„çº¦æŸæµ‹è¯•
def test_layer_dependencies():
    """æµ‹è¯•å±‚æ¬¡ä¾èµ–å…³ç³»"""
    assert not has_reverse_dependency('common', 'services')
    assert not has_reverse_dependency('services', 'core')
    assert not has_reverse_dependency('core', 'ui')

def test_responsibility_purity():
    """æµ‹è¯•èŒè´£çº¯åº¦"""
    assert measure_purity('src/core') > 0.95
    assert measure_purity('src/services') > 0.95
    assert measure_purity('src/common') > 0.95
    assert measure_purity('src/ui') > 0.95
```

### æ€§èƒ½åŸºå‡†æµ‹è¯•

```python
# æ€§èƒ½åŸºå‡†æµ‹è¯•
def benchmark_analysis_performance():
    """æµ‹è¯•åˆ†ææ€§èƒ½"""
    start_time = time.time()
    analyzer.analyze_frame(test_frame)
    end_time = time.time()
    
    assert (end_time - start_time) < 0.1  # 100mså†…å®Œæˆ

def benchmark_memory_usage():
    """æµ‹è¯•å†…å­˜ä½¿ç”¨"""
    initial_memory = get_memory_usage()
    run_analysis_loop(1000)
    final_memory = get_memory_usage()
    
    assert (final_memory - initial_memory) < 100 * 1024 * 1024  # ä¸è¶…è¿‡100MB
```

---

**æœ¬æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2024å¹´  
**ç›¸å…³æ–‡æ¡£**: [README.md](../README.md) | [å¼€å‘è€…æŒ‡å—](developer-guide.md) | [APIæ–‡æ¡£](api/)  

<div align="center">

**ğŸ—ï¸ ç°ä»£åŒ–åˆ†å±‚æ¶æ„ï¼Œä¸ºå¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§è€Œè®¾è®¡**

</div>